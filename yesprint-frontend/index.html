<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YES Print</title>

    <!-- Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#000000">

    <!-- Optional favicon -->
    <link rel="icon" href="/manifest-assets/icon-192.png" sizes="192x192">

    <!-- axios -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script> -->

    <!-- Scripts with defer download in parallel but execute only after the HTML is fully parsed -->
    <script defer src="script.js"></script>
</head>

<body>
    <div hidden id="modal">
        <!-- <div> Full Screen Install Modal </div> -->
        <h1 style="margin: 20px;"> Install YES Print App</h1>
        <div style="display: flex; justify-content: center; margin-top: 30px;">
            <button id="install-btn-1"> Install Now</button>
            <button id="maybe-later-btn">Later</button>
        </div>
    </div>

    <!-- Button on top-right corner -->
    <button hidden id="install-btn-2">Install App</button>


    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; margin-top: 30px;">
        <!-- <button style="margin-top: 20px; padding: 5px 10px; background: transparent;" onclick="location.reload()">
            Reload Page
        </button> -->

        <button id="setup-app-btn" style="display: none; margin-top: 20px; padding: 5px 10px; background: transparent;"
            onclick="setupApp()">
            Setup App
        </button>

        <!-- ❤️ ❤️ ❤️ ❤️ Enable this for debugging: ❤️ ❤️ ❤️ ❤️ -->
        <!-- <div style="margin-top: 20px">isPwaInstalled: <span id="isPwaInstalled"></span></div> -->
    </div>

    <script>
        $ = document.querySelector.bind(document); const $$ = document.querySelectorAll.bind(document); // optional for multiple elements

        const goToApp = () => {
            // Replace current page (no back)
            window.location.replace("https://mypot.in/yesprint-chats");
        };

        const isPwaInstalledEl = $('#isPwaInstalled');
        function renderPwaInstalledEl() {
            const isPwaInstalled = localStorage.getItem('isPwaInstalled');
            if (isPwaInstalledEl) { // Learn: We only update element if it is in dom because we only need this for debugging purpose only.
                isPwaInstalledEl.textContent = isPwaInstalled === null ? 'null' : isPwaInstalled;
            }
        }
        renderPwaInstalledEl();

        // This event is fired when PWA is successfully installed:
        window.addEventListener('appinstalled', () => {
            localStorage.setItem('isPwaInstalled', 'true');
            // Re-render the pwa icon with updated value.
            renderPwaInstalledEl();
            // Show setup app button after pwa was installed:
            $('#setup-app-btn').style = 'block';
        });

        // App: http://localhost:8080
        runOnPageLoad();
        function runOnPageLoad() {
            const params = new URLSearchParams(window.location.search);
            // Delete App: http://localhost:8080/?deleteApp=true
            if (params.get('deleteApp') === 'true') {
                localStorage.setItem('isAppSetup', '');
                localStorage.setItem('isPwaInstalled', '');
                window.location.href = "/";
            } else {
                const isAppSetup = localStorage.getItem('isAppSetup');
                if (isAppSetup) {
                    goToApp();
                }
            }
        }

        // To debug `runOnPageLoad()` we can run it after 3_000.
        // setTimeout(runOnPageLoad, 3_000);

        function setupApp() {
            localStorage.setItem('isAppSetup', true);
            goToApp();
        }
    </script>


    <style>
        * {
            box-sizing: border-box;
        }

        #modal {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;

            margin: auto;
            text-align: left;
            border: 1px solid black;
            border-radius: 5px;
            width: 80vw;
            height: 60vh;
            padding-top: 30px;
            font-size: 16px;
            background: lightyellow;
        }

        /* Button on modal */
        #install-btn-1 {
            background: lightcoral;
            padding: 15px;
            font-weight: bold;
        }

        #maybe-later-btn {
            background: lightgray;
            padding: 15px;
            font-weight: bold;
            margin-left: 20px;
        }

        /* Button on top-rigth corner */
        #install-btn-2 {
            position: absolute;
            top: 10px;
            right: 20px;
            padding: 10px;
            background: lightcoral;
            font-weight: bold;
        }

        button {
            border-radius: 10px;
        }
    </style>
</body>

</html>